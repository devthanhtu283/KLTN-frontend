{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from \"@angular/core\";\nlet TestComponent = class TestComponent {\n  constructor(route, testService, questionService) {\n    this.route = route;\n    this.testService = testService;\n    this.questionService = questionService;\n    this.now = 0;\n    this.selectedOptions = {};\n    this.textAnswers = {};\n    this.errorMsg = \"\";\n    this.showResultPage = false;\n    this.userScore = 0;\n    this.maxScore = 0;\n    this.passingScore = 80;\n    this.steps = [];\n    this.startTest = false; // Biến kiểm soát hiển thị màn hình hướng dẫn\n    this.timeLeft = 30 * 60; // Thời gian làm bài: 30 phút (tính bằng giây)\n  }\n\n  ngOnInit() {\n    this.route.paramMap.subscribe(params => {\n      this.code = params.get(\"code\");\n    });\n    this.testService.findTestByCode(this.code).then(res => {\n      console.log(res);\n      this.title = res.data.title;\n      this.companyName = res.data.userName;\n      this.questionService.findByTestID(res.data.id).then(result => {\n        this.steps = result;\n        console.log(result);\n        this.totalSteps = this.steps.length;\n        this.maxScore = this.steps.filter(step => step.questionType === \"choiceAnswer\").length * 20;\n        console.log(this.maxScore);\n      });\n    });\n  }\n  // Bắt đầu đếm ngược thời gian\n  startTimer() {\n    this.timerInterval = setInterval(() => {\n      if (this.timeLeft > 0) {\n        this.timeLeft--;\n      } else {\n        clearInterval(this.timerInterval);\n        this.calculateScore(); // Tự động tính điểm khi hết giờ\n      }\n    }, 1000);\n  }\n  // Định dạng thời gian thành phút:giây\n  formatTime(seconds) {\n    const minutes = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${minutes}:${secs < 10 ? \"0\" : \"\"}${secs}`;\n  }\n  // Các phương thức khác giữ nguyên\n  getCurrentStep() {\n    return this.steps[this.now];\n  }\n  validate(stepId) {\n    const currentStep = this.steps[stepId - 1];\n    if (currentStep.questionType === \"choiceAnswer\" && !this.selectedOptions[stepId]) {\n      this.errorMsg = \"Hãy chọn đáp án\";\n      return false;\n    } else if (currentStep.questionType === \"textAnswer\" && !this.textAnswers[stepId]) {\n      this.errorMsg = \"Hãy điền câu trả lời!\";\n      return false;\n    }\n    this.errorMsg = \"\";\n    return true;\n  }\n  nextStep() {\n    if (this.validate(this.now + 1)) {\n      this.now = this.now + 1;\n    }\n    if (this.now === this.totalSteps) {\n      this.calculateScore();\n    }\n  }\n  prevStep() {\n    if (this.now > 0) {\n      this.now = this.now - 1;\n    }\n  }\n  calculateScore() {\n    this.userScore = 0;\n    var i = 0;\n    console.log(this.steps);\n    this.steps.forEach(step => {\n      i++;\n      if (step.questionType === \"choiceAnswer\") {\n        console.log(this.selectedOptions[i]);\n        const selectedAnswer = this.selectedOptions[i];\n        const correctAnswer = step.answers.find(answer => answer.correct);\n        console.log(selectedAnswer);\n        console.log(correctAnswer);\n        if (selectedAnswer === correctAnswer?.content) {\n          this.userScore += 20;\n        }\n      }\n    });\n    this.showResultPage = true;\n    clearInterval(this.timerInterval); // Dừng đếm ngược khi tính điểm\n  }\n\n  onOptionSelected(stepId, option) {\n    this.selectedOptions[stepId] = option;\n    console.log(this.selectedOptions[stepId]);\n  }\n  onTextAnswerChange(stepId, answer) {\n    this.textAnswers[stepId] = answer;\n    console.log(this.textAnswers);\n  }\n  isPassed() {\n    return this.userScore / this.maxScore * 100 >= this.passingScore;\n  }\n};\nTestComponent = __decorate([Component({\n  templateUrl: \"./test.component.html\",\n  styleUrls: \"./test.component.css\"\n})], TestComponent);\nexport { TestComponent };","map":{"version":3,"names":["Component","TestComponent","constructor","route","testService","questionService","now","selectedOptions","textAnswers","errorMsg","showResultPage","userScore","maxScore","passingScore","steps","startTest","timeLeft","ngOnInit","paramMap","subscribe","params","code","get","findTestByCode","then","res","console","log","title","data","companyName","userName","findByTestID","id","result","totalSteps","length","filter","step","questionType","startTimer","timerInterval","setInterval","clearInterval","calculateScore","formatTime","seconds","minutes","Math","floor","secs","getCurrentStep","validate","stepId","currentStep","nextStep","prevStep","i","forEach","selectedAnswer","correctAnswer","answers","find","answer","correct","content","onOptionSelected","option","onTextAnswerChange","isPassed","__decorate","templateUrl","styleUrls"],"sources":["D:\\kltn\\src\\KLTN-frontend\\quiz\\src\\app\\components\\test\\test.component.ts"],"sourcesContent":["import { Component, OnInit } from \"@angular/core\";\r\nimport { ActivatedRoute } from \"@angular/router\";\r\nimport { Test } from \"src/app/models/test.model\";\r\nimport { QuestionService } from \"src/app/services/question.service\";\r\nimport { TestService } from \"src/app/services/test.service\";\r\n\r\n@Component({\r\n  templateUrl: \"./test.component.html\",\r\n  styleUrls: \"./test.component.css\"\r\n})\r\nexport class TestComponent implements OnInit {\r\n  now: number = 0;\r\n  totalSteps: number;\r\n  selectedOptions: any = {};\r\n  textAnswers: any = {};\r\n  errorMsg: string = \"\";\r\n  showResultPage: boolean = false;\r\n  userScore: number = 0;\r\n  maxScore: number = 0;\r\n  passingScore: number = 80;\r\n  code: string;\r\n  test: Test;\r\n  title: string;\r\n  companyName: string;\r\n  steps = [];\r\n  startTest: boolean = false; // Biến kiểm soát hiển thị màn hình hướng dẫn\r\n  timeLeft: number = 30 * 60; // Thời gian làm bài: 30 phút (tính bằng giây)\r\n  timerInterval: any; // Biến lưu interval của timer\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private testService: TestService,\r\n    private questionService: QuestionService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.route.paramMap.subscribe((params) => {\r\n      this.code = params.get(\"code\");\r\n    });\r\n\r\n    this.testService.findTestByCode(this.code).then((res) => {\r\n      console.log(res);\r\n      this.title = res.data.title;\r\n      this.companyName = res.data.userName;\r\n      this.questionService.findByTestID(res.data.id).then((result) => {\r\n        this.steps = result;\r\n        console.log(result);\r\n        this.totalSteps = this.steps.length;\r\n        this.maxScore =\r\n          this.steps.filter((step) => step.questionType === \"choiceAnswer\")\r\n            .length * 20;\r\n        console.log(this.maxScore);\r\n      });\r\n    });\r\n  }\r\n\r\n  // Bắt đầu đếm ngược thời gian\r\n  startTimer() {\r\n    this.timerInterval = setInterval(() => {\r\n      if (this.timeLeft > 0) {\r\n        this.timeLeft--;\r\n      } else {\r\n        clearInterval(this.timerInterval);\r\n        this.calculateScore(); // Tự động tính điểm khi hết giờ\r\n      }\r\n    }, 1000);\r\n  }\r\n\r\n  // Định dạng thời gian thành phút:giây\r\n  formatTime(seconds: number): string {\r\n    const minutes = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${minutes}:${secs < 10 ? \"0\" : \"\"}${secs}`;\r\n  }\r\n\r\n  // Các phương thức khác giữ nguyên\r\n  getCurrentStep() {\r\n    return this.steps[this.now];\r\n  }\r\n\r\n  validate(stepId: number): boolean {\r\n    const currentStep = this.steps[stepId - 1];\r\n    if (\r\n      currentStep.questionType === \"choiceAnswer\" &&\r\n      !this.selectedOptions[stepId]\r\n    ) {\r\n      this.errorMsg = \"Hãy chọn đáp án\";\r\n      return false;\r\n    } else if (\r\n      currentStep.questionType === \"textAnswer\" &&\r\n      !this.textAnswers[stepId]\r\n    ) {\r\n      this.errorMsg = \"Hãy điền câu trả lời!\";\r\n      return false;\r\n    }\r\n    this.errorMsg = \"\";\r\n    return true;\r\n  }\r\n\r\n  nextStep() {\r\n    if (this.validate(this.now + 1)) {\r\n      this.now = this.now + 1;\r\n    }\r\n    if (this.now === this.totalSteps) {\r\n      this.calculateScore();\r\n    }\r\n  }\r\n\r\n  prevStep() {\r\n    if (this.now > 0) {\r\n      this.now = this.now - 1;\r\n    }\r\n  }\r\n\r\n  calculateScore() {\r\n    this.userScore = 0;\r\n    var i = 0;\r\n    console.log(this.steps);\r\n    this.steps.forEach((step) => {\r\n      i++;\r\n      if (step.questionType === \"choiceAnswer\") {\r\n        console.log(this.selectedOptions[i]);\r\n        const selectedAnswer = this.selectedOptions[i];\r\n        const correctAnswer = step.answers.find((answer) => answer.correct);\r\n        console.log(selectedAnswer);\r\n        console.log(correctAnswer);\r\n        if (selectedAnswer === correctAnswer?.content) {\r\n          this.userScore += 20;\r\n        }\r\n      }\r\n    });\r\n    this.showResultPage = true;\r\n    clearInterval(this.timerInterval); // Dừng đếm ngược khi tính điểm\r\n  }\r\n\r\n  onOptionSelected(stepId: number, option: string) {\r\n    this.selectedOptions[stepId] = option;\r\n    console.log(this.selectedOptions[stepId]);\r\n  }\r\n\r\n  onTextAnswerChange(stepId: number, answer: string) {\r\n    this.textAnswers[stepId] = answer;\r\n    console.log(this.textAnswers);\r\n  }\r\n\r\n  isPassed() {\r\n    return (this.userScore / this.maxScore) * 100 >= this.passingScore;\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}